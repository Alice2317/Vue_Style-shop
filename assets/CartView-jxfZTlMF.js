import{r as T,l as I,s as q,a as x,b as u,c as p,e as d,d as t,m as c,F,f as L,p as R,v as z,t as _,w as N,n as E,g as S}from"./index-Sq6k6q8w.js";import{c as A,a as m}from"./cartStore-TanCCHxI.js";import{t as e,_ as G}from"./FooterComponent-czLGoVoS.js";import{c as H}from"./methods-0ip-SXLq.js";import{_ as J}from"./HeaderComponent-PB81O0f2.js";import{_ as K}from"./autoplaySwiper-HmipjltQ.js";import"https://cdn.jsdelivr.net/npm/sweetalert2@11.10.6/+esm";const O={class:"container"},P={key:0,class:"mt-3"},Q=t("h3",{class:"mt-3 mb-4 fw-bold"},"訂單確認",-1),W={class:"row"},X={class:"col-md-8"},Y={class:"table"},Z=t("thead",{class:"border-bottom"},[t("tr",null,[t("th",{scope:"col",class:"border-0 ps-0"},"商品"),t("th",{scope:"col",class:"border-0"},"數量"),t("th",{scope:"col",class:"border-0"},"價格"),t("th",{scope:"col",class:"border-0"})])],-1),tt={scope:"row",class:"border-0 px-0 font-weight-normal py-4"},ot=["src","alt"],st={class:"mb-0 fw-bold ms-3 d-inline-block"},et={class:"border-0 align-middle",style:{"max-width":"160px"}},at={class:"input-group pe-5"},nt={class:"input-group-prepend"},lt=["onClick"],ct=t("i",{class:"fas fa-minus"},null,-1),rt=[ct],dt={class:"input-group-append"},it=["onClick"],ut=t("i",{class:"fas fa-plus"},null,-1),pt=[ut],_t={class:"border-0 align-middle"},ht={class:"mb-0 ms-auto"},bt={class:"border-0 align-middle"},ft=["onClick"],mt=t("i",{class:"fas fa-times"},null,-1),vt=[mt],gt={class:"input-group w-50 mb-3"},yt=t("i",{class:"fas fa-paper-plane"},null,-1),xt=[yt],wt=t("span",null,"首購族優惠碼：",-1),Ct=t("span",null,[S("first5off"),t("i",{class:"far fa-copy ms-2 cursor-pointer"})],-1),$t=[Ct],kt={class:"col-md-4"},Vt={class:"border p-4 mb-4"},Tt=t("h4",{class:"fw-bold mb-4"},"金額",-1),qt={class:"table text-muted border-bottom"},Ft=t("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"}," 總金額 ",-1),Nt={class:"text-end border-0 px-0 pt-4"},St=t("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"}," 折扣價 ",-1),Ut={class:"text-end border-0 px-0 pt-0 pb-4"},Bt={class:"d-flex justify-content-between mt-4"},Mt=t("p",{class:"mb-0 h4 fw-bold"},"Total",-1),jt={class:"mb-0 h4 fw-bold"},Dt={key:1,class:"py-6"},It=t("h3",{class:"fw-bold text-center"},"尚未購買商品",-1),Lt=t("p",{class:"text-center"},"首購族打5折優惠，快來選購",-1),Rt=[It,Lt],zt={class:"my-5"},Qt={__name:"CartView",setup(Et){const v=T(H),U=I(),{isLoading:a}=q(U),w=A(),{finalTotal:g,total:y,carts:C}=q(w),{getCarts:h}=w;function $(n,o,l){if(n){if(l>=10)return}else if(l<=1)return;a.value=!0;const r=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${o}`;m.put(r,{data:{product_id:o,qty:n?++l:--l}}).then(i=>{i.data.success?(e(!0,"成功"),h()):e(!1,"失敗，請重新操作"),a.value=!1}).catch(i=>{e(!1,"失敗，請重新操作"),console.error("cartView-updateCount出錯",i),a.value=!1})}function B(n,o){if(o>10||o<1)return;a.value=!0;const l=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${n}`;m.put(l,{data:{product_id:n,qty:Number(o)}}).then(r=>{r.data.success?(e(!0,"成功"),h()):e(!1,"失敗，請重新操作"),a.value=!1}).catch(r=>{e(!1,"失敗，請重新操作"),console.error("cartView-InputText出錯",r),a.value=!1})}function M(n){a.value=!0;const o=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${n}`;m.delete(o).then(l=>{l.data.success?(e(!0,"已成功刪除"),h()):e(!1,"失敗，請重新操作"),a.value=!1}).catch(l=>{e(!1,"失敗，請重新操作"),console.error("cartView-removeCart出錯",l),a.value=!1})}const b=T(null);function j(){if(b.value!==""){const n="https://vue3-course-api.hexschool.io//v2/api/rongapi/coupon";a.value=!0,m.post(n,{data:{code:b.value}}).then(o=>{o.data.success?(e(!0,"已更新商品價格"),h()):e(!1,"失敗，請重新操作"),a.value=!1}).catch(o=>{e(!1,"失敗，請重新操作"),console.error("cartView-couponSubmit出錯",o),a.value=!1})}}function D(n){const o=n.target.closest("span").innerText;navigator.clipboard.writeText(o),e(!0,"已成功複製")}return(n,o)=>{var k;const l=x("VField"),r=x("VForm"),i=x("router-link");return u(),p(F,null,[d(J),t("main",O,[(k=c(C))!=null&&k.length?(u(),p("div",P,[Q,t("div",W,[t("div",X,[t("table",Y,[Z,t("tbody",null,[(u(!0),p(F,null,L(c(C),s=>(u(),p("tr",{class:"border-bottom",key:s.id},[t("th",tt,[t("img",{src:s.product.imageUrl,alt:s.id,style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,ot),t("p",st,_(s.product.title),1)]),t("td",et,[d(r,null,{default:N(({errors:V})=>[t("div",at,[t("div",nt,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon1",onClick:f=>$(!1,s.id,s.qty)},rt,8,lt)]),d(l,{name:"number",class:E(["form-control border-0 text-center my-auto shadow-none",{"is-invalid":V.number}]),rules:"required|integer|between:1,10",modelValue:s.qty,"onUpdate:modelValue":f=>s.qty=f,onChange:f=>B(s.id,s.qty)},null,8,["class","modelValue","onUpdate:modelValue","onChange"]),t("div",dt,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon2",onClick:f=>$(!0,s.id,s.qty)},pt,8,it)])])]),_:2},1024)]),t("td",_t,[t("p",ht,"NT$ "+_(s.product.price),1)]),t("td",bt,[t("button",{class:"btn",type:"button",onClick:V=>M(s.id)},vt,8,ft)])]))),128))])]),t("div",gt,[R(t("input",{type:"text",class:"form-control rounded-0 border-bottom border-top-0 border-start-0 border-end-0 shadow-none",placeholder:"請輸入優惠碼","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":o[0]||(o[0]=s=>b.value=s)},null,512),[[z,b.value]]),t("div",{class:"input-group-append"},[t("button",{class:"btn btn-outline-dark border-bottom border-top-0 border-start-0 border-end-0 rounded-0",type:"button",id:"button-addon2",onClick:j},xt)])]),t("ul",{class:"list-group list-group-flush"},[t("li",{class:"list-group-item px-0 d-flex align-items-center"},[wt,t("button",{type:"button",class:"btn p-0 m-0","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"copy",onClick:D},$t)])])]),t("div",kt,[t("div",Vt,[Tt,t("table",qt,[t("tbody",null,[t("tr",null,[Ft,t("td",Nt," NT$ "+_(v.value(c(y))),1)]),t("tr",null,[St,t("td",Ut,_(c(g)-c(y)===0?0:v.value(Math.round(c(g)-c(y)))),1)])])]),t("div",Bt,[Mt,t("p",jt," NT$ "+_(v.value(Math.round(c(g)))),1)]),d(i,{to:{name:"pay"},class:"btn btn-dark w-100 mt-4"},{default:N(()=>[S("下一步")]),_:1})])])])])):(u(),p("div",Dt,Rt)),t("div",zt,[d(K)])]),d(G)],64)}}};export{Qt as default};
